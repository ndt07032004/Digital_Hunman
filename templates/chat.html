<!DOCTYPE html>
<html lang="vi">
<head>
    <title>TourGuideBot - Hướng Dẫn Viên AI</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        function sendMessage() {
            var msg = document.getElementById('msg').value;
            fetch('/get', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'msg=' + encodeURIComponent(msg)
            }).then(response => response.text()).then(answer => {
                document.getElementById('response').innerHTML = answer;
                // Gọi TTS để phát âm thanh
                fetch('/tts', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: answer})
                }).then(res => res.json()).then(data => {
                    var audio = new Audio(data.audio_url);
                    audio.play();
                });
            });
        }

        function startRecording() {
            navigator.mediaDevices.getUserMedia({audio: true}).then(stream => {
                var recorder = new MediaRecorder(stream);
                recorder.start();
                setTimeout(() => recorder.stop(), 5000);  // Ghi 5s
                recorder.ondataavailable = e => {
                    var form = new FormData();
                    form.append('audio', e.data, 'voice.wav');
                    fetch('/asr', {
                        method: 'POST',
                        body: form
                    }).then(res => res.json()).then(data => {
                        document.getElementById('msg').value = data.text;
                        sendMessage();
                    });
                };
            });
        }
    </script>
</head>
<body>
    <div class="chat">
        <div class="card">
            <div class="card-header">TourGuideBot - Hỏi tôi về du lịch, văn hóa Việt Nam!</div>
            <div class="msg_card_body">
                <p id="response">Câu trả lời sẽ hiển thị ở đây.</p>
            </div>
            <div class="card-footer">
                <input id="msg" class="type_msg" placeholder="Nhập câu hỏi...">
                <button class="send_btn" onclick="sendMessage()">Gửi</button>
                <button class="attach_btn" onclick="startRecording()">Mic (Ghi âm)</button>
            </div>
        </div>
    </div>
</body>
</html>